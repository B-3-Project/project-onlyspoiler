<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <title>메인페이지</title>


    <style>
        .title-group {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            align-content: center;
            margin-left: auto;
            margin-right: 20px;
            margin-bottom: 20px;
            height: 150px;
        }

        .button-group {
            justify-content: flex-end;
            align-items: center;
            align-content: center;
            margin-left: auto;
            margin-bottom: 80px;
            right: 20px;
        }

        .head-img {
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            background-color: red;
            left: 50%;
            transform: translateX(-50%);
        }

        .content-button-group {
            flex-direction: column;
            position: relative;
            margin-top: 200px;
            height: 100vh;
            align-items: center;
        }

        .list-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 10px;
        }

        .list-group-item {
            flex: 0 0 calc(20% - 10px);
            margin-bottom: 10px;
            border: none;
            justify-content: center;
            align-items: center;
            display: flex;
        }

        .card-body {
            overflow-y: auto;
            max-height: 100%;
        }

        .modal-body {
            overflow-y: auto;
            max-height: 400px;
        }

        .modal-header {
            overflow-y: auto;
            max-height: 100px;
        }
    </style>
</head>

<body>
    <img src="image\보람삼조.png" alt="이미지 설명" class="head-img">
    <div class="title-group" id="title">

        <div class="button-group" id="button-group">

            <button type="button" class="btn btn-primary" id="mypageButton">
                마이페이지
            </button>
            <button id='writeButton' type="button" class="btn btn-primary" data-toggle="modal" data-target="#write">
                글쓰기
            </button>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#login" id="loginButton">
                로그인
            </button>
            <button type="button" class="btn btn-primary" style="display: none;" id="logoutButton">
                로그아웃
            </button>

            <button id='registerButton' type="button" class="btn btn-primary" data-toggle="modal" data-target="#회원가입">
                회원가입
            </button>

        </div>

    </div>

    <div class="content-button-group">
        <div class="list-group d-flex flex-row" id="buttonContainer">
        </div>
        <div id="modalContainer">
        </div>
    </div>

    <!-- 글쓰기 모달-->

    <div class="modal fade" id="write" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">글쓰기:</h1>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="postForm">
                        <div class="form-group">
                            <label for="content-title">제목:</label>
                            <textarea class="form-control" id="content-title" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="modalContent">글 내용:</label>
                            <textarea class="form-control" id="modalContent" rows="3"></textarea>
                        </div>
                        <div>

                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitPost()">글 등록</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 로그인 모달 -->

    <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">로그인</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id='login'>
                        <div class="form-group">
                            <label for="email">이메일</label>
                            <input type="text" class="form-control" id="email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="password">비밀번호:</label>
                            <input type="password" class="form-control" id="password" name="password">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="openForgotPasswordModal()">비밀번호
                            찾기</button>
                        <button type="submit" class="btn btn-primary">로그인</button>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="forgotPassword" tabindex="-1" role="dialog" aria-labelledby="forgotPasswordModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="forgotPasswordModalLabel">비밀번호 찾기</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>블라블라블라.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 회원가입 모달 -->

    <div class="modal fade" id="회원가입" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">회원가입</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="registrationForm">
                        <div class="form-group">
                            <label for="username">사용자 이름:</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="form-group">
                            <label for="email">이메일:</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="password">비밀번호:</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">비밀번호 확인:</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                    <button type="submit" class="btn btn-primary">가입하기</button>
                </div>
                </form>
            </div>
        </div>
    </div>

</body>

<script>
    document.getElementById("mypageButton").addEventListener("click", function () {
        location.href = "./mypage.html";
    });

    window.onload = function () {
        const accessToken = localStorage.getItem('accessToken');

        if (accessToken) {
            $('#loginButton').hide();
            $('#logoutButton').show();
            $('#registerButton').hide();
            $('#mypageButton').show();
            $('#writeButton').show();

            //게시물 전체 조회
            fetch("http://localhost:3006/api/contents", {
                method: "GET",
                headers: {
                  "Content-Type": "application/json"
                }
              })
                .then(response => {
                  if (!response.ok) {
                    throw response.json().then(errorData => {
                        alert(errorData.message);
                    });
                  }
                  return response.json();
                })
                .then(getData => {
                  // 성공적으로 데이터를 받아왔을 때의 동작
                  getData.data.forEach(x=>{
                    console.log(x);
                    addButtonAndModal(x.title, x.content, x.id, x.author, "buttonContainer");

                  });
                })
                .catch(error => {
                  // 오류 발생 시의 동작
                  console.error("에러 발생:", error);
                });

        } else {
            $('#loginButton').show();
            $('#logoutButton').hide();
            $('#mypageButton').hide();
            $('#writeButton').hide();
        }
    }

    // 회원가입 API 연결
    document.querySelector('#registrationForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const username = document.querySelector('#registrationForm #username').value;
        const email = document.querySelector('#registrationForm #email').value;
        const password = document.querySelector('#registrationForm #password').value;
        const confirmPassword = document.querySelector('#registrationForm #confirmPassword').value;

        const response = await fetch('http://localhost:3006/api/auth/signup', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name: username, email, password, passwordConfirm: confirmPassword })
        });

        if (response.ok) {
            const responseData = await response.json();
            alert(responseData.message);
            $('#register').modal('hide');

            location.reload();
        } else {
            const errorData = await response.json();
            alert(`Error: ${errorData.error.message}`);
        }
    });


    // 로그인 API 연결
    document.querySelector('#login form').addEventListener('submit', async (event) => {
        event.preventDefault();

        const email = document.querySelector('#email').value;
        const password = document.querySelector('#password').value;

        const response = await fetch('http://localhost:3006/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
        });

        if (response.ok) {
            const responseData = await response.json();
            alert(responseData.message);
            $('#login').modal('hide');

            localStorage.setItem('accessToken', responseData.data.accessToken);
            localStorage.setItem('refreshToken', responseData.data.refreshToken);

            localStorage.setItem('userId', responseData.data.userId);

            //location.reload();
            location.href = "./mypage.html";
        } else {
            const errorData = await response.json();
            alert(`Error: ${errorData.error.message}`);
        }
    })

    // 로그아웃 API 연결
    document.querySelector('#logoutButton').addEventListener('click', async (event) => {
        const response = await fetch('http://localhost:3006/api/auth/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
            },
            body: JSON.stringify({ refreshToken: localStorage.getItem('refreshToken') })
        });

        if (response.ok) {
            const responseData = await response.json();
            alert(responseData.message);

            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');

            location.reload();
        } else {
            const errorData = await response.json();
            alert(`Error: ${errorData.error.message}`);
        }
    })

    function formatTime() {
        var now = new Date();
        var year = now.getFullYear();
        var month = (now.getMonth() + 1).toString().padStart(2, '0');
        var day = now.getDate().toString().padStart(2, '0');
        var hours = now.getHours().toString().padStart(2, '0');
        var minutes = now.getMinutes().toString().padStart(2, '0');
        var seconds = now.getSeconds().toString().padStart(2, '0');

        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }
    document.addEventListener("DOMContentLoaded", function () {

        var existingPosts = JSON.parse(localStorage.getItem('posts')) || [];

        existingPosts.forEach(function (post) {
            addButtonAndModal(post.title, post.content, post.id, post.username, "buttonContainer");
        });
    });

    function submitPost() {

        const confirmSave = confirm("등록하시겠습니까?");

        if (!confirmSave) return;
    
        const title = document.querySelector('#content-title').value;
        const content = document.querySelector('#modalContent').value;
        
    
        // 토큰 가져오기
        const accessToken = localStorage.getItem("accessToken");

    
        if (accessToken) {
            //게시물 작성
            fetch("http://localhost:3006/api/contents/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${accessToken}`
                },
                body: JSON.stringify({ title,content })
                })
                .then(response => {
                    if (!response.ok) {
                        throw response.json().then(errorData => {
                            alert(errorData.message);
                        });
                    }
                    return response.json();
                })
                .then(getData => {
                    // 성공적으로 데이터를 받아왔을 때의 동작
                    alert(getData.message);
    
                    location.reload();
                })
                .catch(error => {
                    // 오류 발생 시의 동작
                    console.error("에러 발생:", error);
                });
        } else {
            console.log("토큰이 없습니다. 로그인이 필요합니다.");
        }
    }

    function addButtonAndModal(buttonText, modalContent, postId, username, newsFeedContainerId) {
        // 버튼과 모달을 위한 고유한 ID 생성
        var modalId = "modal" + new Date().getTime();
        var cardId = "card" + new Date().getTime();

        // 댓글 목록
        var modalComments ='';

        // 토큰 가져오기
        const accessToken = localStorage.getItem("accessToken");

        // 버튼 HTML 생성
        var buttonHtml =
            '<button type="button" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#' + modalId + '" style="width: 350px; height: 300px; " data-post-id="' + postId + '">' +
            '   <div class="card text-bg-light mb-3" style="width: 350px; height: 250px;" id="' + cardId + '">' +
            '       <div class="card-header">' + username + '</div>' +
            '       <div class="card-body">' +
            '           <h5 class="card-title">' + buttonText + '</h5>' +
            '           <p class="card-text">' + modalContent + '</p>' +
            '       </div>' +
            '   </div>' +
            '</button>';

        

        // 모달 HTML 생성
        var modalHtml =
            '<div class="modal" id="' + modalId + '" tabindex="-1">' +
            '   <div class="modal-dialog">' +
            '       <div class="modal-content">' +
            '           <div class="modal-header">' +
            '               <h5 class="modal-title">' + buttonText + '</h5>' +
            '               <p><em>작성자: ' + username + '</em></p>' +
            '               <button type="button" class="close" data-dismiss="modal" aria-label="Close">' +
            '                   <span aria-hidden="true">&times;</span>' +
            '               </button>' +
            '           </div>' +
            '          <div class="modal-body">' +
            '               <p id="modalContent_' + postId + '">' + modalContent + '</p>' +
            '               <p><em>작성 시간: ' + formatTime() + '</em></p>' +
            '               <div class="form-group">' +
            '                   <label for="comment">댓글:</label>' +
            '                   <textarea class="form-control" id="comment_' + postId + '" rows="3"></textarea>' +
            '               </div>' +
            '               <button type="button" class="btn btn-primary" onclick="submitComment(\'' + postId + '\')">댓글 등록</button>' +
            '               <div id="commentContainer_' + postId + '"></div>' +
            '           </div>' +
            '           <div class="modal-footer">' +
            '               <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="exitModal()"(>닫기</button>' +
            '               <button type="button" class="btn btn-warning" onclick="editPostAndSaveButton(\'' + modalId + '\', \'' + postId + '\')">수정</button>' +
            '               <button type="button" class="btn btn-danger" onclick="deletePost(\'' + modalId + '\', \'' + postId + '\')">삭제</button>' +
            '           </div>' +
            '       </div>' +
            '   </div>' +
            '</div>';

        //생성
        $("#" + newsFeedContainerId).prepend(buttonHtml);
        $("#modalContainer").append(modalHtml);


        if (accessToken) {
            //댓글 조회
            fetch("http://localhost:3006/api/comments/"+postId, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${accessToken}`
                }
                })
                .then(response => {
                    if (!response.ok) {
                        throw response.json().then(errorData => {
                            alert(errorData.message);
                        });
                    }
                    return response.json();
                })
                .then(getData => {
                    // 성공적으로 데이터를 받아왔을 때의 동작
                    console.log('getComment:'+getData);

                    getData.data.forEach(x=>{
                        console.log(x);

                        modalComments +=
                        '<div id="' + x.id + '" class="comment-container">' +
                        '<p class="comment-text" style="margin-bottom: 0;">' + x.comments +
                        '<button type="button" class="btn btn-danger btn-sm ml-2 delete-comment" data-post-id="' + postId + '" data-comment-id="' + x.id + '">&times;</button>' +
                        '<button type="button" class="btn btn-info btn-sm ml-2 edit-comment" data-post-id="' + postId + '" data-comment-id="' + x.id + '">Edit</button></p>' +
                        '</div>';

                      });

                      $('#commentContainer_' + postId).append(modalComments);
                    })
                .catch(error => {
                    // 오류 발생 시의 동작
                    console.error("에러 발생:", error);
                    });
        } else {
            console.log("토큰이 없습니다. 로그인이 필요합니다.");
        }
    }

    function deletePost(modalId, postId) {
        // 모달 닫기
        $("#" + modalId).modal('hide');

        setTimeout(function () {
            var confirmDelete = confirm("포스트를 삭제하시겠습니까?");
            if (confirmDelete) {

                // 토큰 가져오기
                const accessToken = localStorage.getItem("accessToken");
        
                var editedContent = $("#editedContent_" + postId).val();
        
                if (accessToken) {
                    //게시물 삭제
                    fetch("http://localhost:3006/api/contents/"+postId, {
                        method: "DELETE",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${accessToken}`
                        },
                        body: JSON.stringify({ content:editedContent })
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw response.json().then(errorData => {
                                    alert(errorData.message);
                                });
                            }
                            return response.json();
                        })
                        .then(getData => {
                            // 성공적으로 데이터를 받아왔을 때의 동작
                            alert(getData.message);
                            location.reload();
                        })
                        .catch(error => {
                            // 오류 발생 시의 동작
                            console.error("에러 발생:", error);
                        });
                } else {
                    console.log("토큰이 없습니다. 로그인이 필요합니다.");
                }
            }
        }, 150);
    }


    function editPostAndSaveButton(modalId, postId) {
        // 모달 콘텐츠를 TEXTAREA로 변경
        var modalContentParagraph = $("#modalContent_" + postId);
        var modalContent = modalContentParagraph.text().trim();
        var modalTextAreaHtml = '<textarea class="form-control" id="editedContent_' + postId + '" rows="3">' + modalContent + '</textarea>';
        modalContentParagraph.replaceWith(modalTextAreaHtml);

        
        // "수정" 버튼 대신 "저장" 버튼 생성
        var saveButtonHtml = '<button type="button" class="btn btn-success" onclick="saveEditedContent(\'' + modalId + '\', \'' + postId + '\')">저장</button>';
        $("#" + modalId + " .modal-footer").find('.btn-warning').replaceWith(saveButtonHtml);
        /*
        // "저장" 버튼을 다시 "수정" 버튼으로 변경
        var editButtonHtml = '<button type="button" class="btn btn-warning" onclick="editPostAndSaveButton(\'' + modalId + '\', \'' + postId + '\')">수정</button>';
        $("#" + modalId + " .modal-footer").find('.btn-success').replaceWith(editButtonHtml);*/
    }

    function saveEditedContent(modalId, postId) {

        const confirmSave = confirm("수정하시겠습니까?");

        if (!confirmSave) return;

        // 토큰 가져오기
        const accessToken = localStorage.getItem("accessToken");

        var editedContent = $("#editedContent_" + postId).val();

        if (accessToken) {
            //게시물 수정
            fetch("http://localhost:3006/api/contents/"+postId, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${accessToken}`
                },
                body: JSON.stringify({ content:editedContent })
                })
                .then(response => {
                    if (!response.ok) {
                        throw response.json().then(errorData => {
                            alert(errorData.message);
                        });
                    }
                    return response.json();
                })
                .then(getData => {
                    // 성공적으로 데이터를 받아왔을 때의 동작
                    alert(getData.message);

                    // 수정된 내용을 원래 내용에 업데이트
                    var modalTextArea = $("#editedContent_" + postId);
                    var modalContentParagraphHtml = '<p id="modalContent_' + postId + '">' + editedContent + '</p>';
                    modalTextArea.replaceWith(modalContentParagraphHtml);
            
                    // "저장" 버튼을 다시 "수정" 버튼으로 변경
                    var editButtonHtml = '<button type="button" class="btn btn-warning" onclick="editPostAndSaveButton(\'' + modalId + '\', \'' + postId + '\')">수정</button>';
                    $("#" + modalId + " .modal-footer").find('.btn-success').replaceWith(editButtonHtml);

                    location.reload();
                })
                .catch(error => {
                    // 오류 발생 시의 동작
                    console.error("에러 발생:", error);
                });
        } else {
            console.log("토큰이 없습니다. 로그인이 필요합니다.");
        }
    }

    function submitComment(postId) {
        var comment = $('#comment_' + postId).val().trim();

        if (comment === '') {
            alert("댓글 내용을 입력하세요.");
            return;
        }

        const confirmSave = confirm("댓글 등록하시겠습니까?");

        if (!confirmSave) return;

        // 토큰 가져오기
        const accessToken = localStorage.getItem("accessToken");

        // 사용자 id 가져오기
        const userId = localStorage.getItem("userId");


        if (accessToken) {
            //댓글 등록
            fetch("http://localhost:3006/api/comments/"+postId, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${accessToken}`
                },
                body: JSON.stringify({ comments:comment })
                })
                .then(response => {
                    if (!response.ok) {
                        throw response.json().then(errorData => {
                            alert(errorData.message);
                        });
                    }
                    return response.json();
                })
                .then(getData => {
                    // 성공적으로 데이터를 받아왔을 때의 동작
                    alert(getData.message);

                    var commentHtml =
                    '<div id="' + getData.data.id + '" class="comment-container">' +
                    '<p class="comment-text" style="margin-bottom: 0;">' + comment +
                    '<button type="button" class="btn btn-danger btn-sm ml-2 delete-comment" data-post-id="' + postId + '" data-comment-id="' + getData.data.id + '">&times;</button>' +
                    '<button type="button" class="btn btn-info btn-sm ml-2 edit-comment" data-post-id="' + postId + '" data-comment-id="' + getData.data.id + '">Edit</button></p>' +
                    '</div>';
                    $('#commentContainer_' + postId).prepend(commentHtml);
                    $('#comment_' + postId).val('');



                })
                .catch(error => {
                    // 오류 발생 시의 동작
                    console.error("에러 발생:", error);
                });
        } else {
            console.log("토큰이 없습니다. 로그인이 필요합니다.");
        }
    }

    function exitModal() {

        location.reload();

    }

    $('#modalContainer').on('click', '.delete-comment', function () {
        var postId = $(this).data('post-id');
        var commentId = $(this).data('comment-id');

        const confirmSave = confirm("댓글 삭제하시겠습니까?");

        if (!confirmSave) return;

        // 토큰 가져오기
        const accessToken = localStorage.getItem("accessToken");

        // 사용자 id 가져오기
        const userId = localStorage.getItem("userId");

        if (accessToken) {
            //댓글 삭제
            fetch("http://localhost:3006/api/comments/"+postId+"/"+commentId, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${accessToken}`
                }
                })
                .then(response => {
                    if (!response.ok) {
                        throw response.json().then(errorData => {
                            alert(errorData.message);
                        });
                    }
                    return response.json();
                })
                .then(getData => {
                    // 성공적으로 데이터를 받아왔을 때의 동작
                    alert(getData.message);
                    $('#' + commentId).remove();
                })
                .catch(error => {
                    // 오류 발생 시의 동작
                    console.error("에러 발생:", error);
                });
        } else {
            console.log("토큰이 없습니다. 로그인이 필요합니다.");
        }

    });

    $('#modalContainer').on('click', '.edit-comment', function () {
        var postId = $(this).data('post-id');
        var commentId = $(this).data('comment-id');
        var currentCommentContainer = $('#' + commentId);
        var currentComment = currentCommentContainer.find('.comment-text').text();

        var editedComment = prompt('Edit your comment:', currentComment);

        if (editedComment !== null) {

            // 토큰 가져오기
            const accessToken = localStorage.getItem("accessToken");

            // 사용자 id 가져오기
            const userId = localStorage.getItem("userId");


            if (accessToken) {
                //댓글 수정
                fetch("http://localhost:3006/api/comments/"+postId+"/"+commentId, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${accessToken}`
                    },
                    body: JSON.stringify({ comments:editedComment })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw response.json().then(errorData => {
                                alert(errorData.message);
                            });

                        }
                        return response.json();
                    })
                    .then(getData => {
                        // 성공적으로 데이터를 받아왔을 때의 동작
                        alert(getData.message);

                        var editedCommentHtml =
                        '<div id="' + commentId + '" class="comment-container">' +
                        '<p class="comment-text" style="margin-bottom: 0;">' + editedComment +
                        '<button type="button" class="btn btn-danger btn-sm ml-2 delete-comment" data-post-id="' + postId + '" data-comment-id="' + commentId + '">&times;</button>' +
                        '<button type="button" class="btn btn-info btn-sm ml-2 edit-comment" data-post-id="' + postId + '" data-comment-id="' + commentId + '">Edit</button></p>' +
                        '</div>';
                        currentCommentContainer.html(editedCommentHtml);

                    })
                    .catch(error => {
                        // 오류 발생 시의 동작
                        console.error("에러 발생:", error);
                    });
            } else {
                console.log("토큰이 없습니다. 로그인이 필요합니다.");
            }

        }
    });
</script>



</html>